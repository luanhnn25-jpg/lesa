<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Projeto Integrador • Pesquisa Oficial</title>

<style>
:root{
  --bg:#0d0d0d;
  --card:#171717;
  --border:#2a2a2a;
  --text:#f5f5f5;
  --muted:#a3a3a3;
  --accent:#ffffff;
  --shadow:0 10px 30px rgba(0,0,0,.5);
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:18px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{
  margin:0;
  font-size:18px;
  font-weight:700;
}
.badge{
  background:#1f1f1f;
  border:1px solid var(--border);
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  color:var(--muted);
}
main{
  max-width:900px;
  margin:30px auto;
  padding:0 20px 80px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}
input{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#111;
  color:var(--text);
  font-size:15px;
}
input:focus{
  outline:none;
  border-color:#444;
}
.controls{
  margin-top:15px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
button{
  padding:12px 18px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#1c1c1c;
  color:var(--text);
  cursor:pointer;
  transition:.15s;
  font-weight:600;
}
button:hover{background:#222}
button.primary{
  background:#fff;
  color:#000;
  border:none;
}
button.primary:hover{opacity:.9}
.output{
  margin-top:20px;
  white-space:pre-wrap;
  line-height:1.6;
  font-size:14px;
}
.refs{
  margin-top:20px;
}
.refs a{
  display:block;
  color:#ccc;
  margin-bottom:6px;
  text-decoration:none;
}
.refs a:hover{color:#fff}
footer{
  text-align:center;
  margin-top:60px;
  color:var(--muted);
  font-size:13px;
}
</style>
</head>
<body>

<header>
  <h1>Projeto Integrador • Pesquisa Oficial</h1>
  <div class="badge">Modo IA ativo</div>
</header>

<main>
  <div class="card">
    <input id="q" placeholder="Digite sua pergunta para pesquisa em fontes oficiais brasileiras..." />

    <div class="controls">
      <button class="primary" id="buscar">Pesquisar</button>
      <button id="pdf">Baixar PDF</button>
      <button id="share">Compartilhar</button>
      <button id="clear">Limpar</button>
    </div>

    <div id="resultado" class="output"></div>

    <div id="referencias" class="refs"></div>
  </div>

  <footer>
    © 2026 Projeto Integrador • Ministério da Saúde • COFEN • COREN • OPAS Brasil
  </footer>
</main>

<script>
const FUNCTION_URL="https://owpswekkfaleauwjmahc.functions.supabase.co/ask";
const qEl=document.getElementById("q");
const resultado=document.getElementById("resultado");
const refs=document.getElementById("referencias");

async function buscar(){
  const q=qEl.value.trim();
  if(!q){
    resultado.textContent="Digite uma pergunta.";
    return;
  }

  resultado.textContent="Consultando fontes oficiais...";
  refs.innerHTML="";

  try{
    const url=new URL(FUNCTION_URL);
    url.searchParams.set("q",q);
    url.searchParams.set("ai","1");

    const res=await fetch(url);
    const data=await res.json();

    resultado.textContent=data.answer||"Sem resposta.";

    (data.web||[]).forEach(r=>{
      const a=document.createElement("a");
      a.href=r.url;
      a.target="_blank";
      a.textContent=r.source+" • "+r.url;
      refs.appendChild(a);
    });

  }catch(e){
    resultado.textContent="Erro ao consultar.";
  }
}

document.getElementById("buscar").onclick=buscar;

document.getElementById("clear").onclick=()=>{
  qEl.value="";
  resultado.textContent="";
  refs.innerHTML="";
};

document.getElementById("share").onclick=()=>{
  const link=window.location.origin+window.location.pathname+"?q="+encodeURIComponent(qEl.value);
  navigator.clipboard.writeText(link);
  alert("Link copiado.");
};

document.getElementById("pdf").onclick=()=>{
  const content="Pergunta:\n"+qEl.value+"\n\n"+resultado.textContent;
  const blob=new Blob([content],{type:"application/pdf"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="pesquisa.pdf";
  a.click();
};
</script>

</body>
</html>
