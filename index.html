<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b3d91" />
  <meta name="description" content="Les√£o por Press√£o - Projeto Integrador. Conte√∫do educativo em formato instal√°vel (PWA)." />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="LPP" />

  <title>Les√£o por Press√£o - Projeto Integrador</title>

  <style>
    :root{
      --lpp-blue-1:#0b3d91;
      --lpp-blue-2:#0a2f73;
      --lpp-blue-3:#0b5bd3;
      --lpp-bg:#eef2f7;
      --lpp-card:#ffffff;
      --lpp-text:#0f172a;
      --lpp-muted:#475569;

      --lpp-shadow: 0 12px 30px rgba(2, 6, 23, .10);
      --lpp-shadow-2: 0 18px 45px rgba(2, 6, 23, .14);
      --lpp-shadow-soft: 0 10px 24px rgba(2, 6, 23, .08);

      --lpp-radius: 18px;
      --lpp-max: 980px;

      --lpp-ring: 0 0 0 4px rgba(56, 130, 246, .18);
      --lpp-border: rgba(15, 23, 42, .08);
      --lpp-border2: rgba(255,255,255,.14);

      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#dc2626;
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--lpp-text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(11,91,211,.15), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(11,61,145,.14), transparent 55%),
        var(--lpp-bg);
    }

    /* TOAST */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: #0b2f73;
      color: #eaf2ff;
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 40px rgba(2,6,23,.25);
      padding: 12px 14px;
      border-radius: 14px;
      display:none;
      align-items:center;
      gap:10px;
      z-index: 99999;
      max-width: min(680px, 92vw);
      line-height: 1.35;
      font-weight: 800;
    }
    .toast.show{ display:flex; animation: pop .12s ease both; }
    .toast .dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(245,158,11,.95);
      box-shadow: 0 10px 18px rgba(245,158,11,.25);
      flex:0 0 auto;
    }
    .toast button{
      margin-left:auto;
      border:none;
      background: rgba(255,255,255,.10);
      color:#eaf2ff;
      border:1px solid rgba(255,255,255,.14);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 950;
    }
    @keyframes pop{ from{opacity:0; transform: translateX(-50%) translateY(6px) scale(.98);} to{opacity:1; transform: translateX(-50%) translateY(0) scale(1);} }

    /* HEADER */
    .lpp-header{
      background: linear-gradient(180deg, var(--lpp-blue-1), #0b4ab1);
      color:#fff;
      padding: 28px 16px 18px;
      text-align:center;
      position: relative;
      overflow:hidden;
    }
    .lpp-header::after{
      content:"";
      position:absolute;
      inset:-40px -120px auto -120px;
      height: 160px;
      background: radial-gradient(circle at 50% 40%, rgba(255,255,255,.22), transparent 60%);
      transform: rotate(-2deg);
      pointer-events:none;
    }
    .lpp-header h1{
      margin:0;
      font-size: clamp(26px, 4vw, 38px);
      font-weight: 800;
      letter-spacing: .2px;
      text-shadow: 0 8px 24px rgba(2,6,23,.18);
    }
    .lpp-header p{
      margin:8px 0 0;
      opacity:.92;
      font-size: 14px;
    }

    /* NAV */
    .lpp-nav{
      background: var(--lpp-blue-2);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 12px 24px rgba(2,6,23,.12);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .lpp-nav-inner{
      max-width: var(--lpp-max);
      margin: 0 auto;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content: space-between;
    }

    .nav-left{
      min-width:0;
      flex: 1 1 auto;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .nav-links{
      min-width:0;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .nav-links a{
      color:#eaf2ff;
      text-decoration:none;
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 14px;
      line-height: 1;
      white-space: nowrap;
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease, opacity .15s ease;
      outline: none;
      border:1px solid transparent;
      position: relative;
    }
    .nav-links a:hover{
      background: rgba(255,255,255,.14);
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(2,6,23,.18);
      border-color: rgba(255,255,255,.10);
    }
    .nav-links a:focus-visible{
      box-shadow: var(--lpp-ring);
      background: rgba(255,255,255,.14);
    }
    .nav-links a[aria-current="page"]{
      background: rgba(255,255,255,.18);
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 10px 18px rgba(2,6,23,.20);
    }

    /* Destaque Premium na navbar */
    .nav-links a.premium-on{
      background: linear-gradient(180deg, rgba(22,163,74,.22), rgba(22,163,74,.14));
      border-color: rgba(22,163,74,.35);
      box-shadow: 0 12px 24px rgba(2,6,23,.18);
    }
    .nav-links a.premium-on::after{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: 999px;
      border:1px solid rgba(22,163,74,.22);
      pointer-events:none;
    }

    .nav-right{
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .auth-actions{
      display:none;
      align-items:center;
      gap:10px;
    }
    .auth-actions a{
      color:#eaf2ff;
      text-decoration:none;
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
      white-space:nowrap;
    }
    .auth-actions a:hover{
      background: rgba(255,255,255,.14);
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(2,6,23,.18);
    }

    .user-pill{
      display:none;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--lpp-border2);
      background: rgba(255,255,255,.10);
      color:#fff;
      box-shadow: 0 10px 18px rgba(2,6,23,.18);
      cursor:pointer;
      user-select:none;
      max-width: 360px;
      position: relative;
      transition: transform .12s ease, background .12s ease;
    }
    .user-pill:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.12);
    }
    .user-ico{
      width:28px;height:28px;border-radius:999px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.16);
      border: 1px solid rgba(255,255,255,.18);
      flex: 0 0 auto;
    }
    .user-text{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
      line-height:1.1;
    }
    .user-hello{
      font-size:12px;
      opacity:.92;
      font-weight:800;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      font-size:11px;
      font-weight:950;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
    }
    .badge.premium{
      border-color: rgba(22,163,74,.35);
      background: rgba(22,163,74,.15);
    }
    .badge.free{
      border-color: rgba(245,158,11,.35);
      background: rgba(245,158,11,.16);
    }
    .user-email{
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 260px;
      opacity:.96;
    }
    .chev{
      margin-left:6px;
      opacity:.9;
      font-weight:900;
      flex:0 0 auto;
    }
    .user-menu{
      position:absolute;
      right:0;
      top: calc(100% + 10px);
      width: 260px;
      background:#0b2f73;
      border:1px solid rgba(255,255,255,.14);
      border-radius: 16px;
      box-shadow: 0 20px 45px rgba(2,6,23,.30);
      padding:8px;
      display:none;
      z-index: 999;
      transform-origin: top right;
      animation: popMenu .12s ease both;
    }
    @keyframes popMenu{ from{opacity:0; transform: translateY(-6px) scale(.98);} to{opacity:1; transform: translateY(0) scale(1);} }
    .user-menu.open{ display:block; }
    .user-menu a, .user-menu button{
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid transparent;
      background: transparent;
      color:#eaf2ff;
      cursor:pointer;
      font-weight:900;
      text-decoration:none;
      font-size:14px;
      text-align:left;
    }
    .user-menu a:hover, .user-menu button:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.10);
    }
    .user-menu .sep{
      height:1px;
      background: rgba(255,255,255,.14);
      margin:6px 4px;
    }
    .user-note{
      padding:10px 10px;
      border-radius:12px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      font-size:12px;
      color: rgba(234,242,255,.92);
      line-height:1.35;
      margin:6px 4px 8px;
    }

    @media (max-width: 820px){
      .lpp-nav-inner{ flex-wrap:wrap; gap:10px; }
      .nav-left{ width:100%; }
      .nav-links{
        flex-wrap:nowrap;
        overflow-x:auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        padding-bottom: 2px;
      }
      .nav-links::-webkit-scrollbar{ display:none; }
      .nav-right{ width:100%; justify-content:flex-end; }
      .user-pill{ max-width: 100%; }
      .user-email{ max-width: 190px; }
    }

    .lpp-main{
      max-width: var(--lpp-max);
      margin: 22px auto 60px;
      padding: 0 14px;
    }

    .lpp-card{
      background: linear-gradient(180deg, rgba(255,255,255,1), rgba(255,255,255,.98));
      border-radius: var(--lpp-radius);
      box-shadow: var(--lpp-shadow);
      padding: 18px;
      margin: 16px 0;
      border: 1px solid var(--lpp-border);
      position: relative;
      overflow:hidden;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      will-change: transform;
    }
    .lpp-card:hover{
      transform: translateY(-3px);
      box-shadow: var(--lpp-shadow-2);
      border-color: rgba(11,91,211,.22);
    }

    .lpp-title{
      display:flex;
      align-items:center;
      gap: 10px;
      margin:0 0 10px;
      font-size: 20px;
      font-weight: 900;
      color: #0b2b63;
      letter-spacing: .2px;
    }
    .lpp-title::before{
      content:"";
      width: 4px;
      height: 22px;
      border-radius: 999px;
      background: var(--lpp-blue-3);
      display:inline-block;
      box-shadow: 0 10px 18px rgba(11,91,211,.25);
    }
    .lpp-text{
      margin:0;
      color: var(--lpp-muted);
      line-height: 1.6;
      font-size: 15px;
    }
    .lpp-figure{
      margin: 14px 0 0;
      border-radius: 16px;
      overflow:hidden;
      background:#f8fafc;
      border: 1px solid #e5e7eb;
      box-shadow: var(--lpp-shadow-soft);
    }
    .lpp-figure img{
      width:100%;
      height:auto;
      display:block;
    }

    .lpp-pill{
      padding: 10px 12px;
      border-radius: 999px;
      background: #edf4ff;
      border: 1px solid #d8e7ff;
      color:#0b2b63;
      font-weight:900;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, box-shadow .14s ease, background .14s ease;
      box-shadow: 0 10px 18px rgba(2,6,23,.06);
    }
    .lpp-pill:hover{
      background:#e7f0ff;
      transform: translateY(-1px);
      box-shadow: 0 16px 28px rgba(2,6,23,.10);
    }

    .lpp-footer{
      text-align:center;
      color:#64748b;
      font-size: 13px;
      padding: 18px 10px 30px;
    }

    /* PWA MODAL */
    .pwa-modal{
      position: fixed;
      inset: 0;
      background: rgba(2, 6, 23, .55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 999999;
    }
    .pwa-modal.open{ display:flex; }
    .pwa-box{
      width: min(520px, 100%);
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid rgba(15, 23, 42, .10);
      box-shadow: 0 20px 55px rgba(2,6,23,.28);
      padding: 16px;
    }
    .pwa-title{
      margin: 0 0 10px;
      font-size: 18px;
      font-weight: 900;
      color: #0b2b63;
    }
    .pwa-img{
      width: 100%;
      height: auto;
      display:block;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, .10);
      box-shadow: 0 12px 24px rgba(2,6,23,.12);
      margin-bottom: 10px;
    }
    .pwa-text{
      margin: 0 0 12px;
      font-size: 14.5px;
      line-height: 1.6;
      color: #475569;
    }
    .pwa-actions{
      display:flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    .pwa-btn{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      cursor: pointer;
      font-weight: 900;
      font-size: 14px;
    }
    .pwa-btn-primary{ background: #0b3d91; color:#fff; }
    .pwa-btn-secondary{ background:#fff; border-color:#dbe3ef; color:#0f172a; }
    .pwa-btn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 4px rgba(56, 130, 246, .20);
    }
  </style>
</head>

<body>

  <header class="lpp-header">
    <h1>Les√£o por Press√£o</h1>
    <p>Projeto Integrador</p>

    <div style="margin-top:14px;">
      <button id="pwaInstallBtn" class="lpp-pill" style="display:none;">
        üì≤ Instalar aplicativo
      </button>
    </div>
  </header>

  <nav class="lpp-nav" aria-label="Navega√ß√£o principal">
    <div class="lpp-nav-inner">

      <div class="nav-left">
        <div class="nav-links" id="menuLinks">
          <a href="index.html" aria-current="page">In√≠cio</a>
          <a href="nosso-produto.html">Nosso Produto</a>
          <a href="tratamento.html">Tratamento</a>
          <a href="impacto-economico.html">Impacto Econ√¥mico</a>
          <a href="guia-simples.html">Guia Simples</a>

          <!-- üî• PROTEGIDO (vai virar ‚≠ê ou üîí automaticamente) -->
          <a id="navSelecao" href="selecao-produtos.html" data-protected="premium">Sele√ß√£o de Produtos</a>

          <a href="avaliacao.html">Avalia√ß√£o</a>
        </div>
      </div>

      <div class="nav-right">
        <div class="auth-actions" id="authActions">
          <a id="navLogin" href="login.html?mode=login">Entrar</a>
          <a id="navSignup" href="login.html?mode=signup">Criar conta</a>
        </div>

        <div class="user-pill" id="userPill" role="button" aria-haspopup="menu" aria-expanded="false" tabindex="0">
          <div class="user-ico">üë§</div>
          <div class="user-text">
            <div class="user-hello" id="userHello">
              Ol√°,
              <span class="badge free" id="userBadge">Verificando‚Ä¶</span>
            </div>
            <div class="user-email" id="userEmail">Carregando‚Ä¶</div>
          </div>
          <div class="chev">‚ñæ</div>

          <div class="user-menu" id="userMenu" role="menu" aria-label="Menu do usu√°rio">
            <div class="user-note" id="userNote">Verificando seu perfil‚Ä¶</div>
            <a id="navPremium" href="premium.html" role="menuitem">‚≠ê Premium</a>
            <div class="sep"></div>
            <button id="navLogout" type="button" role="menuitem">Sair</button>
          </div>
        </div>
      </div>

    </div>
  </nav>

  <main class="lpp-main">
    <section class="lpp-card" id="conceito">
      <h2 class="lpp-title">Conceito</h2>
      <p class="lpp-text">
        Les√£o por press√£o √© um dano localizado na pele e/ou no tecido subjacente, geralmente sobre
        uma proemin√™ncia √≥ssea, resultante de press√£o prolongada ou press√£o associada ao cisalhamento.
      </p>

      <div class="lpp-figure">
        <img src="lesao.png" alt="Exemplo ilustrativo de les√£o por press√£o em proemin√™ncia √≥ssea" />
      </div>
    </section>

    <section class="lpp-card" id="prevencao">
      <h2 class="lpp-title">Preven√ß√£o</h2>
      <p class="lpp-text">
        Envolve avalia√ß√£o de risco, mudan√ßa de dec√∫bito, uso de superf√≠cies de suporte e cuidados adequados com a pele.
      </p>
    </section>
  </main>

  <footer class="lpp-footer">
    ¬© 2026 - Projeto Integrador
  </footer>

  <!-- ‚úÖ Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    <span class="dot"></span>
    <span id="toastText">Mensagem</span>
    <button id="toastClose" type="button">OK</button>
  </div>

  <!-- ‚úÖ Modal instala√ß√£o -->
  <div id="pwaModal" class="pwa-modal" aria-hidden="true">
    <div class="pwa-box" role="dialog" aria-modal="true" aria-labelledby="pwaTitle">
      <h2 id="pwaTitle" class="pwa-title">Instalar aplicativo</h2>
      <img class="pwa-img" src="saude123.png" alt="Imagem relacionada √† sa√∫de" loading="lazy">
      <p class="pwa-text" id="pwaHelpText">
        No Android (Chrome): abra este site ‚Üí menu ‚ãÆ ‚Üí <b>Instalar app</b> ou <b>Adicionar √† tela inicial</b>.
      </p>
      <div class="pwa-actions">
        <button id="pwaCancel" class="pwa-btn pwa-btn-secondary">Fechar</button>
        <button id="pwaConfirm" class="pwa-btn pwa-btn-primary">Instalar</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker.register("service-worker.js")
          .then(function (registration) {
            console.log("Service Worker registrado:", registration.scope);
          })
          .catch(function (error) {
            console.log("Falha ao registrar Service Worker:", error);
          });
      });
    }
  </script>

  <!-- ‚úÖ Bot√£o instalar -->
  <script>
    let deferredPrompt = null;

    const installBtn = document.getElementById("pwaInstallBtn");
    const modal = document.getElementById("pwaModal");
    const cancelBtn = document.getElementById("pwaCancel");
    const confirmBtn = document.getElementById("pwaConfirm");
    const helpText = document.getElementById("pwaHelpText");

    function openModal(){
      modal.classList.add("open");
      modal.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden", "true");
    }

    window.addEventListener("load", () => {
      installBtn.style.display = "inline-block";
      installBtn.textContent = "üìå Como instalar no Android";
      confirmBtn.textContent = "Entendi";
      confirmBtn.onclick = closeModal;
    });

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;

      installBtn.style.display = "inline-block";
      installBtn.textContent = "üì≤ Instalar aplicativo";

      confirmBtn.textContent = "Instalar";
      confirmBtn.onclick = async () => {
        if (!deferredPrompt) return;
        closeModal();
        deferredPrompt.prompt();
        try { await deferredPrompt.userChoice; }
        finally {
          deferredPrompt = null;
          installBtn.style.display = "none";
        }
      };

      helpText.innerHTML = "Clique em <b>Instalar</b> para adicionar o app √† tela inicial.";
    });

    installBtn?.addEventListener("click", () => openModal());
    cancelBtn?.addEventListener("click", closeModal);
    modal?.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
  </script>

  <!-- ‚úÖ Toast helper + leitura de querystring -->
  <script>
    const toast = document.getElementById("toast");
    const toastText = document.getElementById("toastText");
    const toastClose = document.getElementById("toastClose");

    function showToast(text){
      toastText.textContent = text;
      toast.classList.add("show");
      const t = setTimeout(() => toast.classList.remove("show"), 4500);
      toastClose.onclick = () => { clearTimeout(t); toast.classList.remove("show"); };
    }

    // Ex.: index.html?msg=precisa-premium
    const params = new URLSearchParams(location.search);
    const msg = params.get("msg");
    if (msg === "precisa-premium") showToast("Acesso Premium necess√°rio para Sele√ß√£o de Produtos. Ative o Premium para liberar.");
    if (msg === "sem-sessao") showToast("Fa√ßa login para acessar recursos restritos.");
  </script>

  <!-- ‚úÖ MENU DIN√ÇMICO + Premium guard -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const SUPABASE_URL = "https://owpswekkfaleauwjmahc.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_I58BBfTZcWtPEIIDSuN5MA_sV8jfPfq";
    const SITE_BASE = "https://luanhnn25-jpg.github.io/lesa/";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const authActions = document.getElementById("authActions");
    const userPill = document.getElementById("userPill");
    const userEmail = document.getElementById("userEmail");
    const userMenu = document.getElementById("userMenu");
    const navLogout = document.getElementById("navLogout");
    const userBadge = document.getElementById("userBadge");
    const userNote  = document.getElementById("userNote");
    const navPremium = document.getElementById("navPremium");

    const navSelecao = document.getElementById("navSelecao");

    let premiumFlag = false;

    function showLoggedOut(){
      authActions.style.display = "flex";
      userPill.style.display = "none";
      userMenu.classList.remove("open");
      userPill.setAttribute("aria-expanded", "false");

      // Protegido: deslogado -> manda pro login
      if (navSelecao){
        navSelecao.classList.remove("premium-on");
        navSelecao.textContent = "Sele√ß√£o de Produtos üîí";
        navSelecao.href = "login.html?mode=login";
      }
    }

    function showLoggedIn(email){
      authActions.style.display = "none";
      userPill.style.display = "flex";
      userEmail.textContent = email || "Usu√°rio";
    }

    function setBadge(isPremium){
      premiumFlag = !!isPremium;

      if (premiumFlag){
        userBadge.className = "badge premium";
        userBadge.textContent = "Premium ‚úÖ";
        userNote.textContent = "Seu acesso Premium est√° ativo. Voc√™ pode entrar em Sele√ß√£o de Produtos.";
        navPremium.textContent = "‚≠ê Premium (ativo)";

        if (navSelecao){
          navSelecao.textContent = "Sele√ß√£o de Produtos ‚≠ê";
          navSelecao.href = "selecao-produtos.html";
          navSelecao.classList.add("premium-on");
        }
      } else {
        userBadge.className = "badge free";
        userBadge.textContent = "Gr√°tis";
        userNote.textContent = "Seu plano √© gratuito. Para liberar Premium, toque em ‚ÄúAtivar Premium‚Äù.";
        navPremium.textContent = "‚≠ê Ativar Premium";

        if (navSelecao){
          navSelecao.classList.remove("premium-on");
          navSelecao.textContent = "Sele√ß√£o de Produtos üîí";
          navSelecao.href = "premium.html";
        }
      }
    }

    function toggleMenu(open){
      const willOpen = (typeof open === "boolean") ? open : !userMenu.classList.contains("open");
      userMenu.classList.toggle("open", willOpen);
      userPill.setAttribute("aria-expanded", String(willOpen));
    }

    document.addEventListener("click", (e) => {
      if (!userPill.contains(e.target)) toggleMenu(false);
    });

    userPill.addEventListener("click", () => toggleMenu());
    userPill.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        toggleMenu();
      }
      if (e.key === "Escape") toggleMenu(false);
    });

    navLogout.addEventListener("click", async () => {
      try{ await supabase.auth.signOut(); }
      finally{ window.location.href = SITE_BASE + "index.html"; }
    });

    // Clique no link protegido: se n√£o premium -> premium.html (sem travar)
    navSelecao?.addEventListener("click", (e) => {
      // Se deslogado, href j√° √© login.html
      if (userPill.style.display === "none") return;

      if (!premiumFlag){
        e.preventDefault();
        window.location.href = SITE_BASE + "premium.html";
      }
    });

    // Anti ‚Äúcarregando infinito‚Äù
    const hardTimeout = setTimeout(() => showLoggedOut(), 3500);

    async function loadPremiumFlag(uid){
      try{
        const { data, error } = await supabase
          .from("profiles")
          .select("premium")
          .eq("id", uid)
          .single();

        if (error) throw error;
        setBadge(!!data?.premium);
      }catch{
        setBadge(false);
      }
    }

    try{
      const { data: { session } } = await supabase.auth.getSession();
      clearTimeout(hardTimeout);

      if (!session?.user){
        showLoggedOut();
        return;
      }

      showLoggedIn(session.user.email);
      userBadge.textContent = "Verificando‚Ä¶";
      userNote.textContent = "Verificando seu perfil‚Ä¶";
      navPremium.textContent = "‚≠ê Premium";

      await loadPremiumFlag(session.user.id);

      supabase.auth.onAuthStateChange(async (_event, newSession) => {
        if (newSession?.user){
          showLoggedIn(newSession.user.email);
          await loadPremiumFlag(newSession.user.id);
        } else {
          showLoggedOut();
        }
      });

    }catch{
      clearTimeout(hardTimeout);
      showLoggedOut();
    }
  </script>

</body>
</html>